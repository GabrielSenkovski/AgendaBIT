{% extends 'base.html' %}

{% block title %}Visão Semanal - Minha Agenda{% endblock %}

{% block content %}
<div class="agenda">
    <div class="cabecalho-superior text-center py-2">
        <a href="#" class="mudar-semana px-3">← Semana anterior</a>
        <span class="px-3"><strong>Dia:</strong> {{ semana.dia_atual }}</span>
        <span class="nome-agenda px-3 h4">Minha Agenda</span>
        <span class="px-3"><strong>Semana:</strong> {{ semana.inicio }} - {{ semana.fim }}</span>
        <a href="#" class="mudar-semana px-3">Semana seguinte →</a>
    </div>

    <div class="d-flex">
        <div class="lateral-esquerda p-3">
            <div class="compromissos mb-4">
                <h5>Próximos compromissos</h5>
                <ul class="lista-compromissos list-unstyled">
                    {% for agendamento in proximos_agendamentos %}
                        <li>
                            <strong>{{ agendamento.titulo }}</strong><br>
                            <small>{{ agendamento.data_evento.strftime('%d/%m/%Y') }}</small>
                        </li>
                        <hr>
                    {% else %}
                        <li>Nenhum compromisso agendado.</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="botoes-marcar d-flex flex-column">
                <button id="abrir-agendamento" class="btn btn-primary mb-2">Agendar</button>
                <button class="btn btn-secondary mb-2" disabled>Editar</button>
                <button class="btn btn-danger mb-2" disabled>Remover</button>
            </div>
        </div>

        <div class="flex-grow-1">
            <table class="table table-bordered calendario">
                <thead>
                    <tr class="dias-semana text-center">
                        {% for dia in semana.dias %}
                            <th>{{ dia.nome }} <br><small>{{ dia.data }}</small></th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody class="horarios">
                    {% for hora in horarios_da_semana %}
                    <tr>
                        <td class="text-center font-weight-bold">{{ hora.hora }}:00</td>
                        
                        {% for agendamento in hora.agendamentos %}
                            <td class="text-center">
                                {% if agendamento %}
                                    <div class="alert alert-info p-1">
                                        {{ agendamento.titulo }}
                                    </div>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="modal-agendamento" class="modal-agenda" style="display:none; position: fixed; z-index: 1050; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div class="modal-content mx-auto my-5 p-4 bg-light" style="max-width: 500px; border-radius: 8px;">
        <span id="fechar-modal" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        
        {% include 'form.html' %}
    </div>
</div>

{% endblock %}


{% block scripts %}
<script>
    // Script para abrir e fechar o modal
    const modal = document.getElementById("modal-agendamento");
    const btnAbrir = document.getElementById("abrir-agendamento");
    const btnFechar = document.getElementById("fechar-modal");

    btnAbrir.onclick = function() {
        modal.style.display = "block";
    }

    btnFechar.onclick = function() {
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
{% endblock %}